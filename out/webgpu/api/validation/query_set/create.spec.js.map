{"version":3,"sources":["../../../../../src/webgpu/api/validation/query_set/create.spec.ts"],"names":["description","poptions","makeTestGroup","kQueryTypes","kMaxQueryCount","ValidationTest","g","test","desc","cases","subcases","fn","t","type","count","params","selectDeviceForQueryTypeOrSkipTestCase","pipelineStatistics","expectValidationError","device","createQuerySet","undefined","shouldError","length","Array","from","Set"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAFO,CAIP,SAASC,QAAT,QAAyB,gDAAzB;AACA,SAASC,aAAT,QAA8B,4CAA9B;AACA,SAASC,WAAT,EAAsBC,cAAtB,QAA4C,6BAA5C;AACA,SAASC,cAAT,QAA+B,uBAA/B;;AAEA,OAAO,MAAMC,CAAC,GAAGJ,aAAa,CAACG,cAAD,CAAvB;;AAEPC,CAAC,CAACC,IAAF,CAAO,OAAP;AACGC,IADH;AAEK;AACL;AACA;AACA;AACA,GANA;;AAQGC,KARH,CAQSR,QAAQ,CAAC,MAAD,EAASE,WAAT,CARjB;AASGO,QATH,CASY,MAAMT,QAAQ,CAAC,OAAD,EAAU,CAAC,CAAD,EAAIG,cAAJ,EAAoBA,cAAc,GAAG,CAArC,CAAV,CAT1B;AAUGO,EAVH,CAUM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEC,IAAF,EAAQC,KAAR,KAAkBF,CAAC,CAACG,MAA1B;;AAEA,QAAMH,CAAC,CAACI,sCAAF,CAAyCH,IAAzC,CAAN;;AAEA,QAAMI,kBAAkB;AACtBJ,EAAAA,IAAI,KAAK,qBAAT,GAAkC,CAAC,qBAAD,CAAlC,GAAuE,EADzE;;AAGAD,EAAAA,CAAC,CAACM,qBAAF,CAAwB,MAAM;AAC5BN,IAAAA,CAAC,CAACO,MAAF,CAASC,cAAT,CAAwB,EAAEP,IAAF,EAAQC,KAAR,EAAeG,kBAAf,EAAxB;AACD,GAFD,EAEGH,KAAK,GAAGV,cAFX;AAGD,CArBH;;AAuBAE,CAAC,CAACC,IAAF,CAAO,8BAAP;AACGC,IADH;AAEK;AACL;AACA;AACA;AACA;AACA,GAPA;;AASGC,KATH,CASSR,QAAQ,CAAC,MAAD,EAASE,WAAT,CATjB;AAUGO,QAVH,CAUY;AACRT,QAAQ,CAAC,oBAAD,EAAuB,CAACoB,SAAD,EAAY,EAAZ,EAAyB,CAAC,qBAAD,CAAzB,CAAvB,CAXZ;;AAaGV,EAbH,CAaM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEC,IAAF,EAAQI,kBAAR,KAA+BL,CAAC,CAACG,MAAvC;;AAEA,QAAMH,CAAC,CAACI,sCAAF,CAAyCH,IAAzC,CAAN;;AAEA,QAAMC,KAAK,GAAG,CAAd;AACA,QAAMQ,WAAW;AACdT,EAAAA,IAAI,KAAK,qBAAT;AACCI,EAAAA,kBAAkB,KAAKI,SADxB;AAECJ,EAAAA,kBAAkB,CAACM,MAAnB,GAA4B,CAF9B;AAGCV,EAAAA,IAAI,KAAK,qBAAT;AACEI,EAAAA,kBAAkB,KAAKI,SAAvB,IAAoCJ,kBAAkB,CAACM,MAAnB,KAA8B,CADpE,CAJH;;AAOAX,EAAAA,CAAC,CAACM,qBAAF,CAAwB,MAAM;AAC5BN,IAAAA,CAAC,CAACO,MAAF,CAASC,cAAT,CAAwB,EAAEP,IAAF,EAAQC,KAAR,EAAeG,kBAAf,EAAxB;AACD,GAFD,EAEGK,WAFH;AAGD,CA7BH;;AA+BAhB,CAAC,CAACC,IAAF,CAAO,uCAAP;AACGC,IADH;AAEK;AACL;AACA,GAJA;;AAMGE,QANH,CAMY;AACRT,QAAQ,CAAC,oBAAD,EAAuB;AAC7B,CAAC,qBAAD,EAAwB,qBAAxB,CAD6B;AAE7B;AACE,qBADF;AAEE,wBAFF;AAGE,4BAHF;AAIE,6BAJF;AAKE,2BALF,CAF6B,CAAvB,CAPZ;;;;AAkBGU,EAlBH,CAkBM,MAAMC,CAAN,IAAW;AACb,QAAMC,IAAI,GAAG,qBAAb;;AAEA,QAAMD,CAAC,CAACI,sCAAF,CAAyCH,IAAzC,CAAN;;AAEA,QAAMC,KAAK,GAAG,CAAd;AACA,QAAMG,kBAAkB,GAAGL,CAAC,CAACG,MAAF,CAASE,kBAApC;;AAEAL,EAAAA,CAAC,CAACM,qBAAF,CAAwB,MAAM;AAC5BN,IAAAA,CAAC,CAACO,MAAF,CAASC,cAAT,CAAwB,EAAEP,IAAF,EAAQC,KAAR,EAAeG,kBAAf,EAAxB;AACD,GAFD,EAEGA,kBAAkB,CAACM,MAAnB,KAA8BC,KAAK,CAACC,IAAN,CAAW,IAAIC,GAAJ,CAAQT,kBAAR,CAAX,EAAwCM,MAFzE;AAGD,CA7BH","sourcesContent":["export const description = `\nTests for validation in createQuerySet.\n`;\n\nimport { poptions } from '../../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kQueryTypes, kMaxQueryCount } from '../../../capability_info.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('count')\n  .desc(\n    `\nTests that create query set with the count for all query types:\n- count {<, =, >} kMaxQueryCount\n- x= {occlusion, pipeline-statistics, timestamp} query\n  `\n  )\n  .cases(poptions('type', kQueryTypes))\n  .subcases(() => poptions('count', [0, kMaxQueryCount, kMaxQueryCount + 1]))\n  .fn(async t => {\n    const { type, count } = t.params;\n\n    await t.selectDeviceForQueryTypeOrSkipTestCase(type);\n\n    const pipelineStatistics =\n      type === 'pipeline-statistics' ? (['clipper-invocations'] as const) : ([] as const);\n\n    t.expectValidationError(() => {\n      t.device.createQuerySet({ type, count, pipelineStatistics });\n    }, count > kMaxQueryCount);\n  });\n\ng.test('pipelineStatistics,all_types')\n  .desc(\n    `\nTests that create query set with the GPUPipelineStatisticName for all query types:\n- pipelineStatistics is undefined or empty\n- pipelineStatistics is a sequence of valid values\n- x= {occlusion, pipeline-statistics, timestamp} query\n  `\n  )\n  .cases(poptions('type', kQueryTypes))\n  .subcases(() =>\n    poptions('pipelineStatistics', [undefined, [] as const, ['clipper-invocations'] as const])\n  )\n  .fn(async t => {\n    const { type, pipelineStatistics } = t.params;\n\n    await t.selectDeviceForQueryTypeOrSkipTestCase(type);\n\n    const count = 1;\n    const shouldError =\n      (type !== 'pipeline-statistics' &&\n        pipelineStatistics !== undefined &&\n        pipelineStatistics.length > 0) ||\n      (type === 'pipeline-statistics' &&\n        (pipelineStatistics === undefined || pipelineStatistics.length === 0));\n\n    t.expectValidationError(() => {\n      t.device.createQuerySet({ type, count, pipelineStatistics });\n    }, shouldError);\n  });\n\ng.test('pipelineStatistics,duplicates_and_all')\n  .desc(\n    `\nTests that create query set with the duplicate values and all values of GPUPipelineStatisticName for pipeline-statistics query.\n  `\n  )\n  .subcases(() =>\n    poptions('pipelineStatistics', [\n      ['clipper-invocations', 'clipper-invocations'] as const,\n      [\n        'clipper-invocations',\n        'clipper-primitives-out',\n        'compute-shader-invocations',\n        'fragment-shader-invocations',\n        'vertex-shader-invocations',\n      ] as const,\n    ])\n  )\n  .fn(async t => {\n    const type = 'pipeline-statistics';\n\n    await t.selectDeviceForQueryTypeOrSkipTestCase(type);\n\n    const count = 1;\n    const pipelineStatistics = t.params.pipelineStatistics;\n\n    t.expectValidationError(() => {\n      t.device.createQuerySet({ type, count, pipelineStatistics });\n    }, pipelineStatistics.length !== Array.from(new Set(pipelineStatistics)).length);\n  });\n"],"file":"create.spec.js"}