{"version":3,"sources":["../../../../../../src/webgpu/api/validation/encoding/queries/general.spec.ts"],"names":["description","params","poptions","makeTestGroup","kQueryTypes","ValidationTest","F","selectDeviceForQuerySetOrSkipTestCase","type","selectDeviceOrSkipTestCase","undefined","g","test","desc","cases","combine","subcases","fn","t","encoderType","queryIndex","count","pipelineStatistics","querySet","device","createQuerySet","encoder","createEncoder","writeTimestamp","expectValidationError","finish","createQuerySetWithState"],"mappings":";AAAA;AACA,GADA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CARO,CAUP,SAASC,MAAT,EAAiBC,QAAjB,QAAiC,mDAAjC;AACA,SAASC,aAAT,QAA8B,+CAA9B;AACA,SAASC,WAAT,QAA4B,gCAA5B;AACA,SAASC,cAAT,QAA+B,0BAA/B;;AAEA,MAAMC,CAAN,SAAgBD,cAAhB,CAA+B;AAC7B,QAAME,qCAAN,CAA4CC,IAA5C,EAA+E;AAC7E,WAAO,KAAKC,0BAAL;AACLD,IAAAA,IAAI,KAAK,qBAAT;AACI,+BADJ;AAEIA,IAAAA,IAAI,KAAK,WAAT;AACA,qBADA;AAEAE,IAAAA,SALC,CAAP;;AAOD,GAT4B;;;AAY/B,OAAO,MAAMC,CAAC,GAAGR,aAAa,CAACG,CAAD,CAAvB;;AAEPK,CAAC,CAACC,IAAF,CAAO,qCAAP;AACGC,IADH;AAEK;AACL;AACA;AACA;AACA;AACA,GAPA;;AASGC,KATH;AAUIb,MAAM;AACHc,OADH,CACWb,QAAQ,CAAC,aAAD,EAAgB,CAAC,UAAD,EAAa,cAAb,EAA6B,aAA7B,CAAhB,CADnB;AAEGa,OAFH,CAEWb,QAAQ,CAAC,MAAD,EAASE,WAAT,CAFnB,CAVJ;;AAcGY,QAdH,CAcY,CAAC,EAAER,IAAF,EAAD,KAAcN,QAAQ,CAAC,YAAD,EAAeM,IAAI,KAAK,WAAT,GAAuB,CAAC,CAAD,EAAI,CAAJ,CAAvB,GAAgC,CAAC,CAAD,CAA/C,CAdlC;AAeGS,EAfH,CAeM,MAAMC,CAAN,IAAW;AACb,QAAM,EAAEC,WAAF,EAAeX,IAAf,EAAqBY,UAArB,KAAoCF,CAAC,CAACjB,MAA5C;;AAEA,QAAMiB,CAAC,CAACX,qCAAF,CAAwCC,IAAxC,CAAN;;AAEA,QAAMa,KAAK,GAAG,CAAd;AACA,QAAMC,kBAAkB;AACtBd,EAAAA,IAAI,KAAK,qBAAT,GAAkC,CAAC,qBAAD,CAAlC,GAAuE,EADzE;AAEA,QAAMe,QAAQ,GAAGL,CAAC,CAACM,MAAF,CAASC,cAAT,CAAwB,EAAEjB,IAAF,EAAQa,KAAR,EAAeC,kBAAf,EAAxB,CAAjB;;AAEA,QAAMI,OAAO,GAAGR,CAAC,CAACS,aAAF,CAAgBR,WAAhB,CAAhB;AACAO,EAAAA,OAAO,CAACA,OAAR,CAAgBE,cAAhB,CAA+BL,QAA/B,EAAyCH,UAAzC;;AAEAF,EAAAA,CAAC,CAACW,qBAAF,CAAwB,MAAM;AAC5BH,IAAAA,OAAO,CAACI,MAAR;AACD,GAFD,EAEGtB,IAAI,KAAK,WAAT,IAAwBY,UAAU,IAAIC,KAFzC;AAGD,CA/BH;;AAiCAV,CAAC,CAACC,IAAF,CAAO,iCAAP;AACGC,IADH;AAEK;AACL;AACA;AACA,GALA;;AAOGG,QAPH,CAOY,MAAMd,QAAQ,CAAC,aAAD,EAAgB,CAAC,UAAD,EAAa,cAAb,EAA6B,aAA7B,CAAhB,CAP1B;AAQGe,EARH,CAQM,MAAMC,CAAN,IAAW;AACb,QAAMK,QAAQ,GAAGL,CAAC,CAACa,uBAAF,CAA0B,SAA1B,CAAjB;;AAEA,QAAML,OAAO,GAAGR,CAAC,CAACS,aAAF,CAAgBT,CAAC,CAACjB,MAAF,CAASkB,WAAzB,CAAhB;AACAO,EAAAA,OAAO,CAACA,OAAR,CAAgBE,cAAhB,CAA+BL,QAA/B,EAAyC,CAAzC;;AAEAL,EAAAA,CAAC,CAACW,qBAAF,CAAwB,MAAM;AAC5BH,IAAAA,OAAO,CAACI,MAAR;AACD,GAFD;AAGD,CAjBH","sourcesContent":["export const description = `\nTODO:\n\n- For each way to start a query (all possible types in all possible encoders):\n    - queryIndex {in, out of} range for GPUQuerySet\n    - GPUQuerySet {valid, invalid}\n        - or {undefined}, for occlusionQuerySet\n    - x = {occlusion, pipeline statistics, timestamp} query\n`;\n\nimport { params, poptions } from '../../../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { kQueryTypes } from '../../../../capability_info.js';\nimport { ValidationTest } from '../../validation_test.js';\n\nclass F extends ValidationTest {\n  async selectDeviceForQuerySetOrSkipTestCase(type: GPUQueryType): Promise<void> {\n    return this.selectDeviceOrSkipTestCase(\n      type === 'pipeline-statistics'\n        ? 'pipeline-statistics-query'\n        : type === 'timestamp'\n        ? 'timestamp-query'\n        : undefined\n    );\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('writeTimestamp,query_type_and_index')\n  .desc(\n    `\nTests that write timestamp to all types of query set on all possible encoders:\n- type {occlusion, pipeline statistics, timestamp}\n- queryIndex {in, out of} range for GPUQuerySet\n- x= {non-pass, compute, render} encoder\n  `\n  )\n  .cases(\n    params()\n      .combine(poptions('encoderType', ['non-pass', 'compute pass', 'render pass'] as const))\n      .combine(poptions('type', kQueryTypes))\n  )\n  .subcases(({ type }) => poptions('queryIndex', type === 'timestamp' ? [0, 2] : [0]))\n  .fn(async t => {\n    const { encoderType, type, queryIndex } = t.params;\n\n    await t.selectDeviceForQuerySetOrSkipTestCase(type);\n\n    const count = 2;\n    const pipelineStatistics =\n      type === 'pipeline-statistics' ? (['clipper-invocations'] as const) : ([] as const);\n    const querySet = t.device.createQuerySet({ type, count, pipelineStatistics });\n\n    const encoder = t.createEncoder(encoderType);\n    encoder.encoder.writeTimestamp(querySet, queryIndex);\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    }, type !== 'timestamp' || queryIndex >= count);\n  });\n\ng.test('writeTimestamp,invalid_queryset')\n  .desc(\n    `\nTests that write timestamp to a invalid queryset that failed during creation:\n- x= {non-pass, compute, render} enconder\n  `\n  )\n  .subcases(() => poptions('encoderType', ['non-pass', 'compute pass', 'render pass'] as const))\n  .fn(async t => {\n    const querySet = t.createQuerySetWithState('invalid');\n\n    const encoder = t.createEncoder(t.params.encoderType);\n    encoder.encoder.writeTimestamp(querySet, 0);\n\n    t.expectValidationError(() => {\n      encoder.finish();\n    });\n  });\n"],"file":"general.spec.js"}