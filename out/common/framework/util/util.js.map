{"version":3,"sources":["../../../../src/common/framework/util/util.ts"],"names":["timeout","StacklessError","Error","constructor","message","stack","undefined","assert","condition","msg","assertReject","p","unreachable","ex","perf","performance","require","now","resolveOnTimeout","ms","Promise","resolve","PromiseTimeoutError","rejectOnTimeout","_resolve","reject","raceWithRejectOnTimeout","race","sortObjectByKey","v","sortedObject","k","Object","keys","sort","objectEquals","x","y","Function","RegExp","valueOf","Array","isArray","length","Date","x1","y1","every","i","indexOf","range","n","fn","map","_"],"mappings":"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","sourcesContent":["import { timeout } from './timeout.js';\n\n/**\n * Error without a stack, which can be used to fatally exit from `tool/` scripts with a\n * user-friendly message (and no confusing stack).\n */\nexport class StacklessError extends Error {\n  constructor(message: string) {\n    super(message);\n    this.stack = undefined;\n  }\n}\n\nexport function assert(condition: boolean, msg?: string | (() => string)): asserts condition {\n  if (!condition) {\n    throw new Error(msg && (typeof msg === 'string' ? msg : msg()));\n  }\n}\n\nexport async function assertReject(p: Promise<unknown>, msg?: string): Promise<void> {\n  try {\n    await p;\n    unreachable(msg);\n  } catch (ex) {\n    // Assertion OK\n  }\n}\n\nexport function unreachable(msg?: string): never {\n  throw new Error(msg);\n}\n\n// performance.now() is available in all browsers, but not in scope by default in Node.\nconst perf = typeof performance !== 'undefined' ? performance : require('perf_hooks').performance;\n\nexport function now(): number {\n  return perf.now();\n}\n\nexport function resolveOnTimeout(ms: number): Promise<void> {\n  return new Promise(resolve => {\n    timeout(() => {\n      resolve();\n    }, ms);\n  });\n}\n\nexport class PromiseTimeoutError extends Error {}\n\nexport function rejectOnTimeout(ms: number, msg: string): Promise<never> {\n  return new Promise((_resolve, reject) => {\n    timeout(() => {\n      reject(new PromiseTimeoutError(msg));\n    }, ms);\n  });\n}\n\nexport function raceWithRejectOnTimeout<T>(p: Promise<T>, ms: number, msg: string): Promise<T> {\n  return Promise.race([p, rejectOnTimeout(ms, msg)]);\n}\n\nexport function sortObjectByKey(v: { [k: string]: unknown }): { [k: string]: unknown } {\n  const sortedObject: { [k: string]: unknown } = {};\n  for (const k of Object.keys(v).sort()) {\n    sortedObject[k] = v[k];\n  }\n  return sortedObject;\n}\n\nexport function objectEquals(x: unknown, y: unknown): boolean {\n  if (typeof x !== 'object' || typeof y !== 'object') return x === y;\n  if (x === null || y === null) return x === y;\n  if (x.constructor !== y.constructor) return false;\n  if (x instanceof Function) return x === y;\n  if (x instanceof RegExp) return x === y;\n  if (x === y || x.valueOf() === y.valueOf()) return true;\n  if (Array.isArray(x) && Array.isArray(y) && x.length !== y.length) return false;\n  if (x instanceof Date) return false;\n  if (!(x instanceof Object)) return false;\n  if (!(y instanceof Object)) return false;\n\n  const x1 = x as { [k: string]: unknown };\n  const y1 = y as { [k: string]: unknown };\n  const p = Object.keys(x);\n  return Object.keys(y).every(i => p.indexOf(i) !== -1) && p.every(i => objectEquals(x1[i], y1[i]));\n}\n\nexport function range<T>(n: number, fn: (i: number) => T): T[] {\n  return [...new Array(n)].map((_, i) => fn(i));\n}\n"],"file":"util.js"}